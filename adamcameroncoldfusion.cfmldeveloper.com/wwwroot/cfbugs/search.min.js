function SearchFormConfig(){this.products={details:[{id:1149,name:"ColdFusion",versions:[{id:10206,name:"11.0"},{id:7770,name:"10.0"},{id:9288,name:"9.0.1"},{id:9289,name:"9.0"},{id:9290,name:"8.0.1"},{id:9291,name:"8.0"}]},{id:1958,name:"ColdFusion Builder",versions:[{id:8972,name:"2.0.1"},{id:8104,name:"2.0"},{id:8103,name:"1.0"}]}]};this.products.lookup={1149:{product:this.products.details[0],7770:this.products.details[0].versions[0],9288:this.products.details[0].versions[1],9289:this.products.details[0].versions[2],9290:this.products.details[0].versions[3],9291:this.products.details[0].versions[4]},1958:{product:this.products.details[1],8972:this.products.details[1].versions[0],8104:this.products.details[1].versions[1],8103:this.products.details[1].versions[2]}};return this}function SearchForm(a,b){var c;this.config=a;for(c in b){this[c]=b[c]}this.displayedBugs=[];_searchForm=this;return this}function SearchProxyConfig(a){this.settings={proxyUrl:"http://adamcameroncoldfusion.cfmldeveloper.com/cfbugs/searchProxy.cfm",bugbaseUrl:"https://bugbase.adobe.com/index.cfm",listingRequests:{staticParams:{event:"qSearchBugs",page:1,pageSize:500,handler:"_searchProxy.createListingData"},dynamicParamMap:{product:"product",version:"version"},fields:["title","testConfig","reportedBy","description"]},detailRequests:{eventParam:"event",eventValue:"bug",idParam:"id",handler:"_searchProxy.createDetailData"},callbacks:{getProductId:a.getProductId,getVersionId:a.getVersionId,getKeywords:a.getKeywords}};return this}function DetailExtractor(){_detailExtractor=this;this.notFoundMsg="NOT FOUND";this.$doc}function SearchProxy(a,b,c){_searchProxy=this;this.proxySettings=a;this.searchFormConfig=b;this.detailExtractor=c;this.numberOfSearches=0;this.completedSearches=0;return this}SearchForm.prototype.setProxyConfig=function(a){this.proxyConfig=a};SearchForm.prototype.getProducts=function(){var a='<option value="-1">All</option>';var b="";var c;this.$productSelect.find("option").remove().end().append(a);for(c=0;c<this.config.products.details.length;c++){a='<option value="'+this.config.products.details[c].id+'">'+this.config.products.details[c].name+"</option>";this.$productSelect.find("option").end().append(a)}};SearchForm.prototype.getVersions=function(a){var b='<option value="-1">All</option>';var c=$(this).val();var d;var e;_searchForm.$versionSelect.find("option").remove().end().append(b);if(_searchForm.config.products.lookup[c]){d=_searchForm.config.products.lookup[c].product.versions;for(e=0;e<d.length;e++){b='<option value="'+d[e].id+'">'+d[e].name+"</option>";_searchForm.$versionSelect.find("option").end().append(b)}}};SearchForm.prototype.populateListingResults=function(a){var b;var c;for(b=0;b<a.length;b++){if(_searchForm.displayedBugs.indexOf(a[b].id)===-1){_searchForm.displayedBugs.push(a[b].id);c="<tr>";c+='<td data-bugid="'+a[b].id+'" class="clickable"><a href="#">'+a[b].id+"</a></td>";c+='<td class="nowrap">'+_searchForm._formatDate(a[b].date)+"</td>";c+='<td data-bugid="'+a[b].id+'" class="clickable"><a href="#">'+a[b].title+"</a></td>";c+='<td class="filterable">'+a[b].status+"</td>";c+='<td class="filterable">'+a[b].subStatus+"</td>";c+='<td class="filterable">'+a[b].product+"</td>";c+='<td class="filterable">'+a[b].version+"</td>";c+="</tr>";_searchForm.$results.find("tr").end().append(c);_searchForm.$results.find("tr:last").on("click",".clickable",function(){$(_searchForm).trigger("needDetails",{bugId:$(this).attr("data-bugid")})})}}};SearchForm.prototype.resetResults=function(){_searchForm.displayedBugs=[];_searchForm.$results.html("")};SearchForm.prototype.showResults=function(){if(_searchForm.$resultsDisplay.hasClass("hide")){_searchForm.$resultsDisplay.removeClass("hide").addClass("show")}};SearchForm.prototype.getProductId=function(){var a=_searchForm.$productSelect.find(":selected").val();return a};SearchForm.prototype.getVersionId=function(){var a=_searchForm.$versionSelect.find(":selected").val();return a};SearchForm.prototype.getKeywords=function(){var a=_searchForm.$keywordsInput.val();return a};SearchForm.prototype.finaliseSearch=function(){var a="";var b=["ID","Date","Title","Status","Substatus","Product","Version"];_searchForm.$resultsTable.trigger("update");_searchForm.$resultsTable.trigger("sorton",[[[5,1],[6,1],[0,0]]]);for(var c=3;c<b.length;c++){_searchForm.$resultsTable.find("tbody tr").find("td:eq("+c+")").on("click",function(){var d=$(this).text();a=a===d?"":d;$.uiTableFilter(_searchForm.$resultsTable,a,b[c])})}};SearchForm.prototype.populateDetailResults=function(a){var b="";b+="<h2>"+a.headLine+"</h2>";b+="<p>"+a.date+"</p>";b+="<h3>"+a.bugTitle+"</h3>";b+="<p>Reported by: "+a.reportedBy+"</p>";b+="<p>Found in: "+a.foundInBuild+"</p>";b+="<p>Fixed in: "+a.fixedInBuild+"</p>";b+="<p>Status: "+a.status+"</p>";b+='<div class="bugDescription">'+a.bugDescription+"</div>";var c=_searchForm._getAdobeUrl(a.id);b+='<p><a href="'+c+'" target="_blank">View Bug on Adobe Bugtracker</a></p>';b+="<h4>Comments ("+a.comments.length+")</h4>";if(a.comments.length){for(var d=0;d<a.comments.length;d++){b+="<p>"+a.comments[d].name+"</p>";b+="<p>"+a.comments[d].date+"</p>";b+="<p>"+a.comments[d].comment+"</p>";b+="<hr />"}}else{b+="<p>NONE</p>"}b+="<h4>Votes ("+a.votes.length+")</h4>";if(a.votes.length){for(var d=0;d<a.votes.length;d++){b+="<p>"+a.votes[d].name+"</p>";b+="<p>"+a.votes[d].date+"</p>";b+="<p>"+a.votes[d].comment+"</p>";b+="<hr />"}}else{b+="<p>NONE</p>"}_searchForm.$resultsTabDetail.html("").append(b);_searchForm.$resultsTabs.tabs("select",1)};SearchForm.prototype._getAdobeUrl=function(a){var b=_searchForm.proxyConfig.bugbaseUrl+"?"+_searchForm.proxyConfig.detailRequests.eventParam+"="+_searchForm.proxyConfig.detailRequests.eventValue+"&"+_searchForm.proxyConfig.detailRequests.idParam+"="+a;return b};SearchForm.prototype._formatDate=function(a){var b=new Date(a);var c=b.getDate();var d=b.getMonth()+1;c=c<10?"0"+c:c;d=d<10?"0"+d:d;var e=b.getFullYear()+"-"+d+"-"+c;return e};DetailExtractor.prototype.setDoc=function(a){_detailExtractor.$doc=$(a)};DetailExtractor.prototype.getHeadline=function(){var a=_detailExtractor.$doc.find("h1.title").text().trim();if(!a.length){a=_detailExtractor.notFoundMsg}a=a.replace(/\s+/g," ");return a};DetailExtractor.prototype.getDate=function(){var a=_detailExtractor.$doc.find("h1.title").next("div.actions").text().trim();if(!a.length){a=_detailExtractor.notFoundMsg}return a};DetailExtractor.prototype.getTitle=function(){var a=_detailExtractor.$doc.find("div.content h2").filter(function(a){return $(this).text().trim()==="Title"}).next("p").text().trim();if(!a.length){a=_detailExtractor.notFoundMsg}return a};DetailExtractor.prototype.getDescription=function(){var a=_detailExtractor.$doc.find("div.content h2").filter(function(a){return $(this).text().trim()==="Description"}).next("p").html().trim();if(!a.length){a=_detailExtractor.notFoundMsg}return a};DetailExtractor.prototype.getReportedBy=function(){var a=_detailExtractor._justText(_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="Reported By"}).parent());if(!a.length){a=_detailExtractor.notFoundMsg}return a};DetailExtractor.prototype.getStatus=function(){var a=_detailExtractor._justText(_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="State"}).parent());if(!a.length){a="-"}var b=_detailExtractor._justText(_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="Status"}).parent());if(!b.length){b="-"}var c=_detailExtractor._justText(_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="Reason"}).parent());if(!c.length){c="-"}return a+" / "+b+" / "+c};DetailExtractor.prototype.getFoundInBuild=function(){var a=_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="Found In Build"}).parent().next().text().trim();if(!a.length){a=_detailExtractor.notFoundMsg}return a};DetailExtractor.prototype.getFixedInBuild=function(){var a=_detailExtractor.$doc.find("b").filter(function(a){return $(this).text().trim()==="Fixed In Build"}).parent().next().text().trim();if(!a.length){a="-"}return a};DetailExtractor.prototype.getVotes=function(){var a=[];var b=$("#votes li div.row",_detailExtractor.$doc);var c=[];$("div p.gravatar",b).each(function(a,b){c.push($(b).text().trim())});var d=[];$("div:nth-child(2) p",b).each(function(a,b){d.push($(b).text().trim())});var e=[];$("div p.gravatar",b).next().each(function(a,b){e.push($(b).text().trim())});for(var f=0;f<c.length;f++){a.push({name:c[f],date:e[f],comment:d[f]})}return a};DetailExtractor.prototype.getComments=function(){var a=[];var b=$("#comment li div.row",_detailExtractor.$doc);var c=[];$("div p.gravatar",b).each(function(a,b){c.push($(b).text().trim())});var d=[];$("div:nth-child(2) p",b).each(function(a,b){d.push($(b).text().trim())});var e=[];$("div p.gravatar",b).next().each(function(a,b){e.push($(b).text().trim())});for(var f=0;f<c.length;f++){a.push({name:c[f],date:e[f],comment:d[f]})}return a};DetailExtractor.prototype._justText=function(a){return a.clone().children().remove().end().text().trim()};SearchProxy.prototype.getResults=function(){var a;var b;var c=0;var d=0;var e=0;var f=0;var g=0;var h="";var i=_searchProxy.resolveListingParams();var j=_searchProxy.proxySettings.callbacks.getProductId();var k=_searchProxy.proxySettings.callbacks.getVersionId();var l=_searchProxy.proxySettings.callbacks.getKeywords();var m;if(j!=-1&&_searchProxy.searchFormConfig.products.lookup[j]){a=[_searchProxy.searchFormConfig.products.lookup[j].product]}else{a=_searchProxy.searchFormConfig.products.details}for(c=0;c<a.length;c++){d=a[c].id;if(k!=-1&&_searchProxy.searchFormConfig.products.lookup[d][k]){b=[_searchProxy.searchFormConfig.products.lookup[d][k]]}else{b=a[c].versions}for(e=0;e<b.length;e++){f=b[e].id;for(g=0;g<_searchProxy.proxySettings.listingRequests.fields.length;g++){_searchProxy.numberOfSearches++;m=$.extend({},i);m[_searchProxy.proxySettings.listingRequests.dynamicParamMap.product]=d;m[_searchProxy.proxySettings.listingRequests.dynamicParamMap.version]=f;h=_searchProxy.proxySettings.listingRequests.fields[g];m[h]=l;$.ajax({url:_searchProxy.proxySettings.proxyUrl,dataType:"jsonp",data:m,success:_searchProxy._ajaxSuccessHandler,error:_searchProxy._ajaxErrorHandler,complete:_searchProxy._ajaxCompleteHandler})}}}};SearchProxy.prototype.getDetails=function(a,b){var c={proxiedUrl:_searchProxy.proxySettings.bugbaseUrl,handler:_searchProxy.proxySettings.detailRequests.handler};c[_searchProxy.proxySettings.detailRequests.eventParam]=_searchProxy.proxySettings.detailRequests.eventValue;c[_searchProxy.proxySettings.detailRequests.idParam]=b.bugId;$.ajax({url:_searchProxy.proxySettings.proxyUrl,dataType:"jsonp",data:c,success:function(a,b,c){},error:function(a,b,c){console.log(a);console.log(b);console.log(c)},complete:function(a,b){$(_searchProxy).trigger("detailAjaxComplete")}})};SearchProxy.prototype.resolveListingParams=function(){var a={proxiedUrl:_searchProxy.proxySettings.bugbaseUrl};for(var b in _searchProxy.proxySettings.listingRequests.staticParams){a[b]=_searchProxy.proxySettings.listingRequests.staticParams[b]}return a};SearchProxy.prototype.createListingData=function(a){var b=[];var c;var d=a.payload.QUERY.DATA;for(c in d){b.push({id:d[c][1],status:d[c][2],subStatus:d[c][3],title:d[c][4],date:d[c][5],product:_searchProxy.searchFormConfig.products.lookup[a.product].product.name,version:_searchProxy.searchFormConfig.products.lookup[a.product][a.version].name})}$(_searchProxy).trigger("haveListingResults",[b])};SearchProxy.prototype.createDetailData=function(a){_searchProxy.detailExtractor.setDoc(a.payload);var b={headLine:_searchProxy.detailExtractor.getHeadline(),date:_searchProxy.detailExtractor.getDate(),bugTitle:_searchProxy.detailExtractor.getTitle(),bugDescription:_searchProxy.detailExtractor.getDescription(),reportedBy:_searchProxy.detailExtractor.getReportedBy(),status:_searchProxy.detailExtractor.getStatus(),foundInBuild:_searchProxy.detailExtractor.getFoundInBuild(),fixedInBuild:_searchProxy.detailExtractor.getFixedInBuild(),votes:_searchProxy.detailExtractor.getVotes(),comments:_searchProxy.detailExtractor.getComments(),id:a.id};$(_searchProxy).trigger("haveDetailResults",b)};SearchProxy.prototype.trackSearches=function(){_searchProxy.completedSearches++;if(_searchProxy.completedSearches>=_searchProxy.numberOfSearches){$(_searchProxy).trigger("searchesComplete");_searchProxy.completedSearches=0;_searchProxy.numberOfSearches=0}};SearchProxy.prototype._ajaxSuccessHandler=function(a,b,c){};SearchProxy.prototype._ajaxErrorHandler=function(a,b,c){console.log(a);console.log(b);console.log(c)};SearchProxy.prototype._ajaxCompleteHandler=function(a,b){$(_searchProxy).trigger("listingAjaxComplete")};$(document).ready(function(){var a=$("#frm");var b=$("select[name=product]",a);var c=$("select[name=version]",a);var d=$("input[name=keywords]",a);var e=$("input[name=btnSearch]",a);var f=$("#results");var g=$("#resultsTable");var h=$("#resultsDisplay");var i=$("#resultsTabs");var j=$("#resultsTabDetail");var k=$("#bugSearch");var l=new SearchFormConfig;var m=new SearchForm(l,{$productSelect:b,$versionSelect:c,$keywordsInput:d,$results:f,$resultsTable:g,$resultsDisplay:h,$resultsTabs:i,$resultsTabDetail:j});var a=$(m);m.getProducts();var n=new SearchProxyConfig({getProductId:m.getProductId,getVersionId:m.getVersionId,getKeywords:m.getKeywords});var o=new SearchProxy(n.settings,l,new DetailExtractor);var p=$(o);m.setProxyConfig(n.settings);i.tabs();g.tablesorter({sortList:[[5,1],[6,1],[0,0]]});a.on({needResults:function(){k.addClass("wait");m.resetResults();o.getResults()},needDetails:function(a,b){k.addClass("wait");o.getDetails(a,b)}});p.on({haveListingResults:function(a,b){m.showResults();m.populateListingResults(b)},listingAjaxComplete:o.trackSearches,searchesComplete:function(){m.finaliseSearch();k.removeClass("wait")},haveDetailResults:function(a,b){m.populateDetailResults(b);k.removeClass("wait")}});b.on("change",m.getVersions);e.on("click",function(){a.trigger("needResults")})})